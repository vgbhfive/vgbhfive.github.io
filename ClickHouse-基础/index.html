<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://i.loli.net/2019/12/10/JF3dKDSkZoPz7h6.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="https://i.loli.net/2019/12/10/JF3dKDSkZoPz7h6.jpg">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="G-QBK8PCQC9B">
  <meta name="baidu-site-verification" content="codeva-K7aZhBcBPm">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"blog.vgbhfive.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":null,"activeClass":"gitalk"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="简介大家都说 MySQL 和 ClickHouse 很像，如果你不了解 ClickHouse，那我觉得你是对的，但若是你了解，那你更需要往下看看。">
<meta property="og:type" content="article">
<meta property="og:title" content="ClickHouse-基础">
<meta property="og:url" content="https://blog.vgbhfive.com/ClickHouse-%E5%9F%BA%E7%A1%80/index.html">
<meta property="og:site_name" content="Vgbhfive&#39;s Blog">
<meta property="og:description" content="简介大家都说 MySQL 和 ClickHouse 很像，如果你不了解 ClickHouse，那我觉得你是对的，但若是你了解，那你更需要往下看看。">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-07-05T15:10:59.000Z">
<meta property="article:modified_time" content="2023-01-01T15:49:16.000Z">
<meta property="article:author" content="vgbhfive">
<meta property="article:tag" content="ClickHouse">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://blog.vgbhfive.com/ClickHouse-%E5%9F%BA%E7%A1%80/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>ClickHouse-基础 | Vgbhfive's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Vgbhfive's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Vgbhfive's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-pictures">

    <a href="/pictures/" rel="section"><i class="fa fa-th fa-fw"></i>Pictures</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/vgbhfive" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://blog.vgbhfive.com/ClickHouse-%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://i.loli.net/2019/12/10/JF3dKDSkZoPz7h6.jpg">
      <meta itemprop="name" content="vgbhfive">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Vgbhfive's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          ClickHouse-基础
        </h1>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-07-05 23:10:59" itemprop="dateCreated datePublished" datetime="2022-07-05T23:10:59+08:00">2022-07-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-01-01 23:49:16" itemprop="dateModified" datetime="2023-01-01T23:49:16+08:00">2023-01-01</time>
              </span>

          
            <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>大家都说 <code>MySQL</code> 和 <code>ClickHouse</code> 很像，如果你不了解 <code>ClickHouse</code>，那我觉得你是对的，但若是你了解，那你更需要往下看看。</p>
<span id="more"></span>

<h3 id="数据定义"><a href="#数据定义" class="headerlink" title="数据定义"></a>数据定义</h3><h4 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h4><p>作为一款分析性数据库，<code>ClickHouse</code> 提供了很多数据类型，这里面主要可以分为基础类型、复合类型和特殊类型。</p>
<h5 id="基础类型"><a href="#基础类型" class="headerlink" title="基础类型"></a>基础类型</h5><p>基础类型主要包含有数值、字符串和时间三种类型，没有 <code>Boolean</code> 类型，但是可以使用整形的 <code>0</code> 和 <code>1</code> 来代替。</p>
<ol>
<li><p>数值类型<br>数值类型分为整数、浮点数和定点数三类。</p>
<ul>
<li><code>Int</code>： <code>ClickHouse</code> 使用 <code>Int8</code>、 <code>Int16</code>、 <code>Int32</code>、 <code>Int64</code> 指代四种大小的 <code>Int</code> 类型，其末尾的数字正好表明占用字节的大小。</li>
<li><code>Float</code>：与整数类似，<code>ClickHouse</code> 直接使用 <code>Float32</code>、 <code>Float64</code> 代表单精度浮点数及双精度浮点数。</li>
<li><code>Decimal</code>：如果需要更高精度的数值运算，则需要使用定点数，<code>ClickHouse</code> 提供了 <code>Decimal32</code>、 <code>Decimal64</code>、 <code>Decimal128</code> 三种精度的定点数。可以通过两种形式声明定点：简写方式有 <code>Decimal32(S)</code>、 <code>Decimal64(S)</code>、 <code>Decimal128(S)</code> 三种；原生方式为 <code>Decimal(P, S)</code>，其中 <code>P</code> 代笔精度，决定总位数（整数部份+小数部分），<code>S</code> 代表规模，决定小数位数。</li>
</ul>
</li>
<li><p>字符串类型<br>字符串类型可以细分为 <code>String</code>、 <code>FixedString</code>、 <code>UUID</code> 三类。</p>
<ul>
<li><code>String</code>：字符串由 <code>String</code> 定义，长度不限。</li>
<li><code>FixedString</code>：定长字符串，在使用时需表明字符串的长度。</li>
<li><code>UUID</code>：<code>UUID</code> 是一种数据库常见的主键类型，在 <code>ClickHouse</code> 中被当作了一种数据类型，<code>UUID</code> 共有 <code>32</code> 位，格式为 <code>8-4-4-4-12</code>，如果一个 <code>UUID</code> 类型的字段在写入时没有被赋值则会被依照格式使用 <code>0</code> 填充。</li>
</ul>
</li>
<li><p>时间类型<br>时间类型分为 <code>DataTime</code>、 <code>DateTime64</code>、 <code>Date</code> 三类，<code>ClickHouse</code> 目前没有时间戳类型，时间类型最高精度是秒，也就是说如果需要处理毫秒、微秒等大于秒分辨率的时间，则只能借助 <code>UInt</code> 类型实现。</p>
<ul>
<li><code>DateTime</code>：包含时、分、秒信息，精确到秒，支持使用字符串形式写入。</li>
<li><code>DateTime64</code>：可以记录亚秒，在 <code>DateTime</code> 之上增加了精度的设置。</li>
<li><code>Date</code>：不包含具体的时间信息，只精确到天，同样也支持字符串形式写入。</li>
</ul>
</li>
</ol>
<h5 id="复合类型"><a href="#复合类型" class="headerlink" title="复合类型"></a>复合类型</h5><p>除了基础类型之外，<code>ClickHouse</code> 还提供了数组、元组、枚举和嵌套四类复合类型。</p>
<ul>
<li><code>Array</code>：数组有两种定义方式，常规方式为 <code>array(T)</code>，或者简写方式 <code>[T]</code>。通过上述发现在查询时并不需要主动声明数组的元素类型，因为 <code>ClickHouse</code> 的数组拥有类型推断的能力，而推断依据则是以最小存储代价为原则，即使用最小可表达的数据类型。</li>
<li><code>Tuple</code>：元组类型由 <code>1~n</code> 个元素组成，每个元素之间允许设置不同的数据类型，且彼此之间不要求兼容。元组同样支持类型推断，其推断仍然以最小的存储代价为原则。与数组类似元组也有两种方式定义，常规方式为 <code>tuple(T)</code>，或者简写方式 <code>(T)</code>。</li>
<li><code>Enum</code>：<code>ClickHouse</code> 支持枚举类型，提供了 <code>Enum8</code> 和 <code>Enum16</code> 两种枚举类型，他们除了取值范围不同之外，别无二致。枚举固定使用 <code>(String:Int) Key/Value</code> 键值对的形式定义数据，所以 <code>Enum8</code> 和 <code>Enum16</code> 分别对应 <code>(String:Int8)</code> 和 <code>(String:Int16)</code>。<br>  <small><code>Key/Value</code> 是不允许重复的，要保证唯一性。另外也不允许为 <code>Null</code>，但是 <code>Key</code> 允许是空字符串。</small></li>
<li><code>Nested</code>：嵌套类型，顾名思义就是一种嵌套表结构。一张表结构，可以定义任意多个嵌套类型字段，但每个字段的嵌套层级只支持一级，即嵌套表内不能继续使用嵌套类型。对于简单场景的层级关系或关联关系，使用嵌套类型也是不错的选择。</li>
</ul>
<h5 id="特殊类型"><a href="#特殊类型" class="headerlink" title="特殊类型"></a>特殊类型</h5><p><code>ClickHouse</code> 还有一类不同的数据类型，那就是特殊类型。</p>
<ul>
<li><code>Nullable</code>：准确说这并不是一种独立的数据类型，更像是一种辅助的修饰符，需要与基础数据一起搭配使用，表示某个基础数据可以是 <code>Null</code> 值。</li>
<li><code>Domain</code>：域名类型分为 <code>IPv4</code> 和 <code>IPv6</code> 两类，本质上就是对整形和字符串的进一步封装。但是在使用时不可当作字符串使用，因为其并不支持隐式的自动类型转换，如果需要返回 <code>IP</code> 的字符串形式，需要显式调用 <code>IPv4NumToString</code> 或 <code>IPv6NumToString</code> 函数进行转换。</li>
</ul>
<h4 id="数据表"><a href="#数据表" class="headerlink" title="数据表"></a>数据表</h4><p>之前说的都是数据类型，接下来就是 <code>DDL</code> 操作及定义数据的方法。</p>
<h5 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE IF NOT EXISTS db_name [ENGINE = engine]</span><br></pre></td></tr></table></figure>
<p>数据库目前一共支持五种默认引擎：</p>
<ul>
<li><code>Ordinary</code>：默认引擎，大多数情况下使用的引擎，使用时无需声明。</li>
<li><code>Dictionary</code>：字典引擎，此类数据库会为所有数据字典创建他们的数据表。</li>
<li><code>Memory</code>：内存引擎，用于存放临时数据。</li>
<li><code>Lazy</code>： 日志引擎，只能使用 <code>Log</code> 系列的表引擎。</li>
<li><code>MySQL</code>：会自动拉取远端 <code>MySQL</code> 中的数据，并为他们创建 <code>MySQL</code> 表引擎的数据表。</li>
</ul>
<h5 id="数据表-1"><a href="#数据表-1" class="headerlink" title="数据表"></a>数据表</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE [IF NOT EXISTS] [db_name.]table_name (</span><br><span class="line">    name1 [type] [DEFAULT|MATERIALIZED|ALIAS expr],</span><br><span class="line">    name2 [type] [DEFAULT|MATERIALIZED|ALIAS expr]</span><br><span class="line">) ENGINE = engine</span><br></pre></td></tr></table></figure>
<p>上面是常见的创建表方式，下面则是通过复制其他表结构来创建表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE [IF NOT EXISTS] [db_name1.]table_name1 AS [db_name2.]table_name2 [ENGINE = engine]</span><br></pre></td></tr></table></figure>

<h5 id="默认值表达式"><a href="#默认值表达式" class="headerlink" title="默认值表达式"></a>默认值表达式</h5><p>表字段支持三种默认值表达式的定义方法，分别是 <code>DEFAULT</code>、 <code>MATERIALIZED</code>、 <code>ALIAS</code>，无论使用哪种形式，表字段一旦被定义了默认值，便不再强制要求定义数据类型，因为 <code>ClickHouse</code> 会根据默认值进行类型推断。若是对表字段定义了数据类型和默认值表达式，则以明确定义的数据类型为主。</p>
<p>默认值表达式的三种定义方法之间也存在着不同之处：</p>
<ul>
<li>在数据写入时，只有 <code>DEFAULT</code> 类型的字段可以出现在 <code>INSERT</code> 语句中，而 <code>MATERIALIZED</code> 和 <code>ALIAS</code> 不能被显式赋值，只能通过计算取值。</li>
<li>在数据查询时，只有 <code>DEFAULT</code> 类型的字段可以出现在 <code>SELECT</code> 语句中，而 <code>MATERIALIZED</code> 和 <code>ALIAS</code> 不能出现在返回结果集中。</li>
<li>在数据存储时，只有 <code>DEFAULT</code> 和 <code>MATERIALIZED</code> 类型的字段才支持持久化，而 <code>ALIAS</code> 类型的字段不能被持久化，它的取值依赖于计算。</li>
</ul>
<h5 id="临时表"><a href="#临时表" class="headerlink" title="临时表"></a>临时表</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE TEMPORARY TABLE [IF NOT EXISTS] [db_name.]table_name (</span><br><span class="line">    name1 [type] [DEFAULT|MATERIALIZED|ALIAS expr],</span><br><span class="line">    name2 [type] [DEFAULT|MATERIALIZED|ALIAS expr]</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>相比普通表而言，临时表由以下两点特殊之处：</p>
<ul>
<li>临时表的生命周期与会话绑定，所以他仅支持 <code>Memory</code> 表引擎，如果会话结束，数据表就会被销毁。</li>
<li>临时表不属于任何数据库，所以在建表语句中，没有数据库参数和表引擎参数。</li>
</ul>
<p><small>临时表的优先级大于普通表，当两张表名称相同时，会优先读取临时表的数据。</small></p>
<h5 id="分区表"><a href="#分区表" class="headerlink" title="分区表"></a>分区表</h5><p>数据分区（<code>partition</code>）和数据分片（<code>shard</code>）是完全不同的两个概念，数据分区是针对本地数据而言的，是数据的一种纵向切分，而数据分片是数据的横向切分。但是目前只有合并树（<code>MergeTree</code>）家族系列的引擎支持数据分区。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE [IF NOT EXISTS] [db_name.]table_name (</span><br><span class="line">    ID String,</span><br><span class="line">    Time Date</span><br><span class="line">) ENGINE = MergeTree()</span><br><span class="line">PARTITION BY toYYYYMM(Time)</span><br><span class="line">ORDER BY ID</span><br></pre></td></tr></table></figure>

<h5 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h5><p><code>ClickHouse</code> 拥有普通和物化两种视图，其中物化视图拥有独立的存储，而普通视图只是一层简单的查询代理。<br>普通视图不会存储任何数据，只是一层简单的 <code>SELECT</code> 查询映射，起着简化查询、明晰语义的作用，对查询性能不会有影响。而物化视图支持表引擎，数据保存形式由他的表引擎决定，物化视图创建好之后，如果源表被写入数据，那么物化视图也会同步更新。<br><code>POPULATE</code> 修饰符决定了物化视图的初始策略，若使用 <code>POPULATE</code> 则在创建视图时会将源表的数据一并导入，反之不使用 <code>POPULATE</code> 则物化视图初始是没有数据的，只会在同步之后写入源表的数据。另外物化视图不支持删除数据，源表中的数据被删除，物化视图中的数据不会被删除。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 创建普通视图的语法</span><br><span class="line">CREATE VIEW [IF NOT EXISTS] [db_name.]view_name AS SELECT ...</span><br><span class="line"># 创建物化视图的语法</span><br><span class="line">CREATE [MATERIALIZED] VIEW [IF NOT EXISTS] [db.]table_name [TO[db.]name] [ENGINE = engine] [POPULATE] AS SELECT ...</span><br></pre></td></tr></table></figure>

<h4 id="数据表操作"><a href="#数据表操作" class="headerlink" title="数据表操作"></a>数据表操作</h4><h5 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h5><ol>
<li><p>追加新字段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE tb_name ADD COLUMN [IF NOT EXISTS] name [type] [default_expr] [AFTER name_after]</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改数据类型</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE tb_name MODIFY COLUMN [IF EXISTS] name [type] [default_expr]</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改备注</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE tb_name COMMENT COLUMN [IF EXISTS] name &#x27;some comment&#x27;</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除已有字段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE tb_name DROP COLUMN [IF EXISTS] name</span><br></pre></td></tr></table></figure>
</li>
<li><p>移动数据表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RENAME TABLE [db_name1.]tb_name1 TO [db_name2.]tb_name2</span><br></pre></td></tr></table></figure>
<p>其原理与 <code>Linux</code> 系统中的 <code>mv</code> 命令异曲同工。</p>
</li>
<li><p>清空数据表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TRUNCATE TABLE [IF EXISTS] [db_name.]tb_name</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询分区信息<br><code>ClickHouse</code> 内置了许多 <code>system</code> 系统表，用于查询自身的状态信息，其中的 <code>parts</code> 系统表专门用于查询数据表的分区信息。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT partition_id, name, table, database FROM system.parts WHERE table = &#x27;partition_v2&#x27;</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除指定分区</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE tb_name DROP PARTITION partition_expr</span><br></pre></td></tr></table></figure>
</li>
<li><p>复制分区数据<br><code>ClickHouse</code> 支持将 <code>A</code> 表的分区数据复制到 <code>B</code> 区，可以用于快速数据写入、多表间数据同步和备份等场景。当然此项特性支持是有前提的：</p>
</li>
</ol>
<ul>
<li>两张表需要拥有相同的分区键。</li>
<li>他们的表结构完全相同。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE B REPLACE PARTITION partition_expr FROM A</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="10">
<li><p>重置分区数据<br>如果数据表的某一列数据有误，需要将其重置为初始值，如果声明了默认值表达式，则以表达式为准，否则以数据类型的默认值为准。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE tb_name CLEAR COLUMN column_name IN PARTITION partition_expr</span><br></pre></td></tr></table></figure>
</li>
<li><p>卸载装载分区<br>表分区可以通过 <code>DETACH</code> 语句卸载，分区被卸载后他的物理数据会被转移到当前数据表目录的 <code>detached</code> 子目录下，而装载分区则是反向操作，可以将 <code>detached</code> 子目录下的某个分区重新装载回去。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 卸载分区语法</span><br><span class="line">ALTER TABLE tb_name DETACH PARTITION partition_expr</span><br><span class="line"># 装载分区语法</span><br><span class="line">ALTER TABLE tb_name ATTACH PARTITION partition_expr</span><br></pre></td></tr></table></figure>
</li>
<li><p>备份还原分区<br>分区在被备份之后，会被统一保存到 <code>ClickHouse</code> 根路径 <code>/shadow/N</code> 子目录下，其中 <code>N</code> 是一个自增长的整数，它的含义是备份的次数，具体次数由 <code>shadow</code> 子目录下的 <code>increment.txt</code> 文件记录。而分区备份实质上是对原始目录文件进行硬链接，所以不会有额外的存储空间。整个备份目录会一直向上追溯到 <code>data</code> 根路径的整个链路。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/data/[database]/[table]/[partition_folder]</span><br></pre></td></tr></table></figure>
<p><code>FETCH</code> 的工作原理与 <code>ReplicatedMergeTree</code> 同步数据的原理类似，<code>FETCH</code> 通过指定的 <code>zk_path</code> 找到 <code>ReplicatedMergeTree</code> 的所有副本实例，然后从中选择一个最合适的副本，并下载相应的分区数据。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 备份分区语法</span><br><span class="line">ALTER TABLE tb_name FREEZE PARTITION partition_expr</span><br><span class="line"># 还原分区语法</span><br><span class="line">ALTER TABLE tb_name FETCH PARTITION partition_expr FROM zk_path</span><br></pre></td></tr></table></figure>
<p><small><code>FETCH</code> 只支持 <code>ReplicatedMergeTree</code> 系列的表引擎。</small></p>
</li>
</ol>
<h5 id="分布式的-DDL-操作"><a href="#分布式的-DDL-操作" class="headerlink" title="分布式的 DDL 操作"></a>分布式的 <code>DDL</code> 操作</h5><p><code>ClickHouse</code> 支持集群模式，一个集群拥有一个到多个节点。<code>CREATE</code>、 <code>ALTER</code>、 <code>DROP</code>、 <code>RENAME</code>、 <code>TRUNCATE</code> 这些 <code>DDL</code> 语句，都支持分布式执行。这意味着在集群中任意一个节点上执行 <code>DDL</code> 语句，那么集群中的每个节点都会以相同的顺序执行相同的语句。<br>将一条普通的 <code>DDL</code> 语句转化为分布式执行十分简单，只需要加上 <code>ON CLUSTER cluster_name</code> 声明即可。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE partition_v3 ON CLUSTER ch_cluster(</span><br><span class="line">    ID String,</span><br><span class="line">    Time Date</span><br><span class="line">) ENGINE = MergeTree()</span><br><span class="line">PARTITION BY toYYYYMM(Time)</span><br><span class="line">ORDRE BY ID</span><br></pre></td></tr></table></figure>

<h5 id="数据操作"><a href="#数据操作" class="headerlink" title="数据操作"></a>数据操作</h5><ol>
<li><p>写入<br><code>INSERT</code> 语句支持三种语法范式，三种范式各有不同，可以根据写入的需求灵活变化。</p>
<ul>
<li>使用 <code>VALUES</code> 格式的常规用法： <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO [db.]tb_name [(c1, c2, c3)] VALUES (v11, v12, v13), (v21, v22, v23)</span><br></pre></td></tr></table></figure></li>
<li>使用指定格式语法： <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO [db.]tb_name [(c1, c2, c3)] FORMAT format_name data_set</span><br></pre></td></tr></table></figure></li>
<li>使用 <code>SELECT</code> 子句形式语法： <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO [db.]tb_name [(c1, c2, c3)] SELECT ...</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>修改和删除<br><code>ClickHouse</code> 提供 <code>DELETE</code> 和 <code>UPDATE</code> 的能力，这类操作被称为 <code>Mutation</code> 查询，可以看作是 <code>ALTER</code> 语句的变种，虽然能实现同样的功能，但是与通常意义上的 <code>DELETE</code> 和 <code>UPDATE</code> 不一样：</p>
<ul>
<li><code>Mutation</code> 语句其实是<strong>很重</strong>的操作，更适用于批量数据的修改和删除。</li>
<li>不支持事务，一旦语句被提交，就会立刻对数据产生影响且无法回滚。</li>
<li><code>Mutation</code> 语句的执行是一个异步的后台过程，语句提交之后会立即返回。但是立即返回并不代表具体逻辑已经执行完毕，具体执行进度需要通过 <code>system.mutations</code> 系统表查询。</li>
</ul>
</li>
</ol>
<p> <code>DELETE</code> 和 <code>UPDATE</code> 语句语法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE [db_name.]tb_name DELETE WHERE filter_expr</span><br><span class="line">ALTER TABLE [db_name.]tb_name UPDATE column1 = expr1, ... WHERE filter_expr</span><br></pre></td></tr></table></figure>

<hr>

<h3 id="数据查询"><a href="#数据查询" class="headerlink" title="数据查询"></a>数据查询</h3><h4 id="WITH-子句"><a href="#WITH-子句" class="headerlink" title="WITH 子句"></a><code>WITH</code> 子句</h4><p><code>ClickHouse</code> 支持 <code>CTE</code> （<code>Common Table Expression</code>，公共表表达式）以增强查询语句的表达。</p>
<ol>
<li><p>定义变量<br>可以定义变量，这些变量能够在后续的查询子句中被直接访问。</p>
</li>
<li><p>调用函数<br>可以访问 <code>SELECT</code> 子句中的列字段，并调用函数做进一步的加工处理。</p>
</li>
<li><p>定义子查询<br>可以定义子查询。<br><small>在 <code>WITH</code> 中使用子查询时有一些需要特别注意，该查询语句只能返回同一行数据，如果结果集的数据大于一行则会抛出异常。</small></p>
</li>
<li><p>在子查询中重复使用 <code>WITH</code><br>在子查询中可以嵌套使用 <code>WITH</code> 子句。</p>
</li>
</ol>
<h4 id="FROM-子句"><a href="#FROM-子句" class="headerlink" title="FROM 子句"></a><code>FROM</code> 子句</h4><p><code>FROM</code> 子句表示从何处读取数据。</p>
<ol>
<li><p>从数据表中读取数据。</p>
</li>
<li><p>从子查询中取数。</p>
</li>
<li><p>从表函数中取数。</p>
</li>
</ol>
<p><small><code>FROM</code> 关键字可以省略，此时会从虚拟表中取数。在 <code>ClickHouse</code> 中，并没有数据库中常见的 <code>DUAL</code> 虚拟表，取而代之的就是 <code>system.one</code>。</small></p>
<h4 id="SAMPLE-子句"><a href="#SAMPLE-子句" class="headerlink" title="SAMPLE 子句"></a><code>SAMPLE</code> 子句</h4><p><code>SAMPLE</code> 子句能够实现数据采样的功能，使查询仅返回采样数据而不是全部数据，从而减少查询负载。<br><small><code>SAMPLE</code> 子句的采样设计是一种幂等设计，也就是说在数据不发生变化的情况下，使用相同的采样规则总是返回相同的数据。</small><br><small><code>SAMPLE</code> 子句只能用于 <code>MergeTree</code> 系列引擎的数据表，并且要求在 <code>CREATE TABLE</code> 时声明 <code>SAMPLE BY</code> 抽样表达式。</small></p>
<ol>
<li><p><code>SAMPLE factor</code><br><code>SAMPLE factor</code> 表示按因子系数采样，其中 <code>factor</code> 表示采样因子，它的取值支持 <code>0~1</code> 之间的小数。如果 <code>factor</code> 设置为 <code>0</code> 或者 <code>1</code>，则效果等同于不进行数据采样。</p>
</li>
<li><p><code>SAMPLE rows</code><br><code>SAMPLE rows</code> 表示按样本数量采样，其中 <code>rows</code> 表示至少采样多少行数据，它的取值必须是大于 <code>1</code> 的整数。如果 <code>rows</code> 的取值大于表内数据的总行数，则效果等于 <code>rows=1</code>（即不使用采样）。</p>
</li>
<li><p><code>SAMPLE factor OFFSET n</code><br><code>SAMPLE factor OFFSET n</code> 表示按因子系数和偏移量采样，其中 <code>factor</code> 表示采样因子，<code>n</code> 表示偏移多少数据后才开始采样，他们两个的取值都是 <code>0~1</code> 之间的小数。</p>
</li>
</ol>
<h4 id="ARRAY-JOIN-子句"><a href="#ARRAY-JOIN-子句" class="headerlink" title="ARRAY JOIN 子句"></a><code>ARRAY JOIN</code> 子句</h4><p><code>ARRAY JOIN</code> 子句允许在数据表内部，与数组或嵌套类型的字段进行 <code>JOIN</code> 操作，从而将一行数据展开为多行。<br><small>在一条 <code>SELECT</code> 语句中，只能存在一个 <code>ARRAY JOIN</code>（使用子查询除外）。目前仅支持 <code>INNER</code> 和 <code>LEFT</code> 两种策略。 </small></p>
<ol>
<li><p><code>INNER ARRAY JOIN</code><br><code>ARRAY JOIN</code> 在默认情况下使用的是 <code>INNER JOIN</code> 策略。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> title, <span class="keyword">value</span> <span class="keyword">FROM</span> query_v1 <span class="keyword">ARRAY</span> <span class="keyword">JOIN</span> <span class="keyword">value</span></span><br><span class="line"># food <span class="number">1</span></span><br><span class="line"># food <span class="number">2</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>LEFT ARRAY JOIN</code><br><code>ARRAY JOIN</code> 子句支持 <code>LEFT</code> 连接策略。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> title, <span class="keyword">value</span>, v <span class="keyword">FROM</span> query_v1 <span class="keyword">LEFT</span> <span class="keyword">ARRAY</span> <span class="keyword">JOIN</span> <span class="keyword">value</span> <span class="keyword">AS</span> v</span><br><span class="line"># food [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] <span class="number">1</span></span><br><span class="line"># food [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] <span class="number">2</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="JOIN-子句"><a href="#JOIN-子句" class="headerlink" title="JOIN 子句"></a><code>JOIN</code> 子句</h4><p><code>JOIN</code> 子句可以对左右两张表的数据进行连接，这是最常用的查询子句之一。它的语法包含连接精度和连接类型两部分。连接精度可以分为 <code>ALL</code>、 <code>ANY</code> 和 <code>ASOF</code> 三种，而连接类型也可以分为外连接（外集合）、内连接（交集）和交叉连接（并集）三种。<br><small>在进行多表连接时，会转化为两两连接的形式。</small></p>
<h5 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h5><ul>
<li>优化 <code>JOIN</code> 性能，首先应<strong>遵循左大右小的原则</strong>。</li>
<li><code>JOIN</code> 查询目前没有缓存的支持。</li>
<li>如果是在大量维度属性补全的查询场景中，建议使用字典代替 <code>JOIN</code> 查询。</li>
<li>连接查询的空值是由默认值填充的，连接查询的空值策略是通过 <code>join_use_nulls</code> 参数指定的，默认是 <code>0</code>。</li>
</ul>
<h4 id="WHERE-和-PREWHERE-子句"><a href="#WHERE-和-PREWHERE-子句" class="headerlink" title="WHERE 和 PREWHERE 子句"></a><code>WHERE</code> 和 <code>PREWHERE</code> 子句</h4><p><code>WHERE</code> 子句基于条件表达式来实现数据过滤。另外还提供了全新的 <code>PREWHERE</code> 子句，<code>PREWHERE</code> 目前只能作用于 <code>MergeTree</code> 系列的表引擎，可以看作是 <code>WHERE</code> 的一种优化，其作用与 <code>WHERE</code> 相同，均用来过滤数据，不过 <code>PREWHERE</code> 只会读取指定的列字段数据，用于数据过滤的条件判断，待数据过滤之后再补齐 <code>SELECT</code> 声明的列字段以补全其余属性。</p>
<h4 id="GROUP-BY-子句"><a href="#GROUP-BY-子句" class="headerlink" title="GROUP BY 子句"></a><code>GROUP BY</code> 子句</h4><p><code>GROUP BY</code> 又称聚合查询，在 <code>GROUP BY</code> 后声明的表达式，通常被称为聚合键或者 <code>Key</code>，数据会按照聚合键进行聚合。</p>
<ol>
<li><p><code>WITH ROLLUP</code><br><code>ROLLUP</code> 能够按照聚合键从右向左上卷数据，基于聚合函数依次生成分组小计和总计。</p>
</li>
<li><p><code>WITH CUBE</code><br><code>CUBE</code> 会像立方体模型一样，基于聚合键之间所有的组合生成小计信息。如果聚合键的个数为 <code>n</code>，则最终小计组合的个数为 <code>2^n</code>。</p>
</li>
<li><p><code>WITH TOTALS</code><br>使用 <code>TOTALS</code> 修饰符后，会基于聚合函数对所有数据进行总计。</p>
</li>
</ol>
<h4 id="HAVING-子句"><a href="#HAVING-子句" class="headerlink" title="HAVING 子句"></a><code>HAVING</code> 子句</h4><p><code>HAVING</code> 子句需要与 <code>GROUP BY</code> 子句同时出现，不能单独使用。它能够在聚合计算之后实现二次过滤数据。<br><small>执行优先级： <code>WHERE &gt; GROUP BY &gt; HAVING</code></small></p>
<h4 id="ORDER-BY-子句"><a href="#ORDER-BY-子句" class="headerlink" title="ORDER BY 子句"></a><code>ORDER BY</code> 子句</h4><p><code>ORDER BY</code> 子句通过声明排序键来指定查询数据返回时的顺序。可以使用多个排序键，每个排序键后需紧跟 <code>ASC</code> 或者 <code>DESC</code>来确定排列顺序，默认 <code>ASC</code>。<br><small>对于 <code>NULL</code> 值的排序，目前拥有 <code>NULLS LAST</code> 和 <code>NULLS FIRST</code> 两种排序方式，含义跟其修饰符有关。另外就是 <code>NaN</code>，总是紧跟在 <code>NULL</code> 身边。</small></p>
<h4 id="LIMIT-BY-子句"><a href="#LIMIT-BY-子句" class="headerlink" title="LIMIT BY 子句"></a><code>LIMIT BY</code> 子句</h4><p><code>LIMIT BY</code> 子句和常见的 <code>LIMIT</code> 所有不同，它运行于 <code>ORDER BY</code> 之后和 <code>LIMIT</code> 之前，能够按照指定分组，最多返回前 <code>n</code> 行数据（如果数据少于 <code>n</code> 行，则按照实际数量返回），常用于 <code>TOP N</code> 的查询场景。另外也支持跳过 <code>OFFSET</code> 偏移量获取数据。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LIMIT n <span class="keyword">BY</span> express</span><br></pre></td></tr></table></figure>

<h4 id="LIMIT-子句"><a href="#LIMIT-子句" class="headerlink" title="LIMIT 子句"></a><code>LIMIT</code> 子句</h4><p><code>LIMIT</code> 子句用于返回指定的前 <code>n</code> 行数据，常用于分页场景。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">LIMIT n</span><br><span class="line">LIMIT n <span class="keyword">OFFSET</span> m</span><br><span class="line">LIMIT m, n</span><br></pre></td></tr></table></figure>

<h4 id="SELECT-子句"><a href="#SELECT-子句" class="headerlink" title="SELECT 子句"></a><code>SELECT</code> 子句</h4><p><code>SELECT</code> 子句决定了一次查询语句最终返回哪些字段或者表达式。</p>
<h4 id="DISTINCT-子句"><a href="#DISTINCT-子句" class="headerlink" title="DISTINCT 子句"></a><code>DISTINCT</code> 子句</h4><p><code>DISTINCT</code> 子句能够去除重复数据，使用场景广泛。</p>
<h4 id="UNION-ALL-子句"><a href="#UNION-ALL-子句" class="headerlink" title="UNION ALL 子句"></a><code>UNION ALL</code> 子句</h4><p><code>UNIUN ALL</code> 子句能够联合左右两边的两组子查询，将结果一并返回。在一次查询中可以声明多个 <code>UNION ALL</code> 以便联合多组查询，但 <code>UNION ALL</code> 不能直接使用其他子句，这些子句只能在其联合的子查询中使用。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a1, b1 <span class="keyword">from</span> tabl1</span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">select</span> a2, b2 <span class="keyword">from</span> table2</span><br></pre></td></tr></table></figure>
<p><small>上述查询中，<code>UNION ALL</code> 两侧的子查询中能够得到节点信息，首先两侧列字段数量必须相同，其次列字段的数据类型必须相同或兼容，最后列字段的名字可以不同但会以左侧的子查询为准。</small></p>
<h4 id="SQL-执行计划"><a href="#SQL-执行计划" class="headerlink" title="SQL 执行计划"></a><code>SQL</code> 执行计划</h4><p><code>ClickHouse</code> 目前并没有直接提供 <code>EXPLAIN</code> 查询，但是借助后台的服务日志，能变相实现该功能。</p>
<ul>
<li>通过将 <code>ClickHouse</code> 服务日志设置到 <code>DEBUG</code> 或者 <code>TRACE</code> 日志级别，可以变相实现 <code>EXPLAIN</code> 查询，以分析 <code>SQL</code> 的执行日志。</li>
<li>需要真正执行 <code>SQL</code> 查询，<code>CH</code> 才能打印计划日志，所以如果表的数据量很大，最好借助 <code>LIMIT</code> 子句以减少查询返回的数据量。</li>
<li>在日志中，分区过滤信息部分 <code>Selected xxx parts by date,</code>，其中 <code>by date</code> 部分是固定的，无论我们的分区键是什么字段，这里都不会变。这是由于在早期版本中，<code>MergeTree</code> 分区键只支持日期字段。</li>
<li>不要使用 <code>select *</code> 全字段查询。</li>
<li>尽可能利用各种索引（分区索引、一级索引、二级索引），这样可以避免全表扫描。</li>
</ul>
<hr>

<h3 id="实用工具"><a href="#实用工具" class="headerlink" title="实用工具"></a>实用工具</h3><h4 id="clickhouse-local"><a href="#clickhouse-local" class="headerlink" title="clickhouse-local"></a><code>clickhouse-local</code></h4><p><code>clickhouse-local</code> 可以独立运行大部分 <code>SQL</code> 查询，不需要依靠任何 <code>ClickHouse</code> 的服务端程序，可以理解成是 <code>ClickHouse</code> 服务的单机版微内核，是一个轻量级的应用程序。<br><code>clickhouse-local</code> 只能够使用 <code>File</code> 表引擎，他的数据与同机运行的 <code>ClickHouse</code> 服务也是完全隔离的，相互之间并不能访问。同时是非交互式运行的，每次执行都需要指定数据来源。</p>
<p>核心参数如下：</p>
<ul>
<li><code>-S/--structure</code>：表结构的简写方式。</li>
<li><code>-N/--table</code>：表名称，默认值是 <code>table</code>。</li>
<li><code>-if/--input-format</code>：输入数据的格式，默认值是 <code>TSV</code>。</li>
<li><code>-f/--file</code>：输入数据的地址，默认值是 <code>stdin</code> 标准输入。</li>
<li><code>-q/--query</code>：待执行的 <code>SQL</code> 语句，多条语句之间以分号间隔。</li>
</ul>
<h4 id="clickhouse-benchmark"><a href="#clickhouse-benchmark" class="headerlink" title="clickhouse-benchmark"></a><code>clickhouse-benchmark</code></h4><p><code>clickhouse-benchmark</code> 是基准测试的小工具，可以自动运行 <code>SQL</code> 查询，并生成相应的运行指标报告。</p>
<p>核心参数如下：</p>
<ul>
<li><code>-i/--iterations</code>：<code>SQL</code> 查询执行的次数，默认值为 <code>0</code>。</li>
<li><code>-c/--concurrency</code>：同时执行查询的并发数，默认值是 <code>1</code>。</li>
<li><code>-r/--randomize</code>：在执行多条 <code>SQL</code> 语句的时候，按照随机顺序执行。</li>
<li><code>-h/--host</code>：服务端地址，默认值是 <code>localhost</code>。</li>
<li><code>--confidence</code>：设置对比测试中置信区间的范围，默认值是 <code>5(99.5%)</code>。取值范围有 <code>0(80%), 1(90%), 2(95%), 3(98%), 4(99%)</code> 和 <code>5(99.5%)</code>。</li>
</ul>
<h4 id="clickhouse-mysql"><a href="#clickhouse-mysql" class="headerlink" title="clickhouse-mysql"></a><code>clickhouse-mysql</code></h4><p><code>clickhouse-mysql</code> 用于将 <code>MySQL</code> 的数据或者 <code>CSV</code> 文件同步到 <code>ClickHouse</code>的工具。</p>
<p><small>其他信息参考另一篇博客，有更详细的说明</small></p>
<hr>

<h3 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h3><hr>

<h3 id="个人备注"><a href="#个人备注" class="headerlink" title="个人备注"></a>个人备注</h3><p><strong>此博客内容均为作者学习所做笔记，侵删！</strong><br><strong>若转作其他用途，请注明来源！</strong></p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/ClickHouse/" rel="tag"># ClickHouse</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/ClickHouse-%E6%A6%82%E8%BF%B0/" rel="prev" title="ClickHouse-概述">
      <i class="fa fa-chevron-left"></i> ClickHouse-概述
    </a></div>
      <div class="post-nav-item">
    <a href="/SpringBoot%E9%9B%86%E6%88%90Prometheus-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8C%87%E6%A0%87/" rel="next" title="SpringBoot集成Prometheus-自定义指标">
      SpringBoot集成Prometheus-自定义指标 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B"><span class="nav-number">1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%AE%9A%E4%B9%89"><span class="nav-number">2.</span> <span class="nav-text">数据定义</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-number">2.1.</span> <span class="nav-text">数据类型</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E7%B1%BB%E5%9E%8B"><span class="nav-number">2.1.1.</span> <span class="nav-text">基础类型</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%A4%8D%E5%90%88%E7%B1%BB%E5%9E%8B"><span class="nav-number">2.1.2.</span> <span class="nav-text">复合类型</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%89%B9%E6%AE%8A%E7%B1%BB%E5%9E%8B"><span class="nav-number">2.1.3.</span> <span class="nav-text">特殊类型</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E8%A1%A8"><span class="nav-number">2.2.</span> <span class="nav-text">数据表</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">2.2.1.</span> <span class="nav-text">数据库</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E8%A1%A8-1"><span class="nav-number">2.2.2.</span> <span class="nav-text">数据表</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%BB%98%E8%AE%A4%E5%80%BC%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="nav-number">2.2.3.</span> <span class="nav-text">默认值表达式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%B8%B4%E6%97%B6%E8%A1%A8"><span class="nav-number">2.2.4.</span> <span class="nav-text">临时表</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%88%86%E5%8C%BA%E8%A1%A8"><span class="nav-number">2.2.5.</span> <span class="nav-text">分区表</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A7%86%E5%9B%BE"><span class="nav-number">2.2.6.</span> <span class="nav-text">视图</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E8%A1%A8%E6%93%8D%E4%BD%9C"><span class="nav-number">2.3.</span> <span class="nav-text">数据表操作</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="nav-number">2.3.1.</span> <span class="nav-text">基本操作</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E7%9A%84-DDL-%E6%93%8D%E4%BD%9C"><span class="nav-number">2.3.2.</span> <span class="nav-text">分布式的 DDL 操作</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C"><span class="nav-number">2.3.3.</span> <span class="nav-text">数据操作</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2"><span class="nav-number">3.</span> <span class="nav-text">数据查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#WITH-%E5%AD%90%E5%8F%A5"><span class="nav-number">3.1.</span> <span class="nav-text">WITH 子句</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#FROM-%E5%AD%90%E5%8F%A5"><span class="nav-number">3.2.</span> <span class="nav-text">FROM 子句</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SAMPLE-%E5%AD%90%E5%8F%A5"><span class="nav-number">3.3.</span> <span class="nav-text">SAMPLE 子句</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ARRAY-JOIN-%E5%AD%90%E5%8F%A5"><span class="nav-number">3.4.</span> <span class="nav-text">ARRAY JOIN 子句</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#JOIN-%E5%AD%90%E5%8F%A5"><span class="nav-number">3.5.</span> <span class="nav-text">JOIN 子句</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="nav-number">3.5.1.</span> <span class="nav-text">注意事项</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#WHERE-%E5%92%8C-PREWHERE-%E5%AD%90%E5%8F%A5"><span class="nav-number">3.6.</span> <span class="nav-text">WHERE 和 PREWHERE 子句</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#GROUP-BY-%E5%AD%90%E5%8F%A5"><span class="nav-number">3.7.</span> <span class="nav-text">GROUP BY 子句</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#HAVING-%E5%AD%90%E5%8F%A5"><span class="nav-number">3.8.</span> <span class="nav-text">HAVING 子句</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ORDER-BY-%E5%AD%90%E5%8F%A5"><span class="nav-number">3.9.</span> <span class="nav-text">ORDER BY 子句</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#LIMIT-BY-%E5%AD%90%E5%8F%A5"><span class="nav-number">3.10.</span> <span class="nav-text">LIMIT BY 子句</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#LIMIT-%E5%AD%90%E5%8F%A5"><span class="nav-number">3.11.</span> <span class="nav-text">LIMIT 子句</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SELECT-%E5%AD%90%E5%8F%A5"><span class="nav-number">3.12.</span> <span class="nav-text">SELECT 子句</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#DISTINCT-%E5%AD%90%E5%8F%A5"><span class="nav-number">3.13.</span> <span class="nav-text">DISTINCT 子句</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#UNION-ALL-%E5%AD%90%E5%8F%A5"><span class="nav-number">3.14.</span> <span class="nav-text">UNION ALL 子句</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92"><span class="nav-number">3.15.</span> <span class="nav-text">SQL 执行计划</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7"><span class="nav-number">4.</span> <span class="nav-text">实用工具</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#clickhouse-local"><span class="nav-number">4.1.</span> <span class="nav-text">clickhouse-local</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#clickhouse-benchmark"><span class="nav-number">4.2.</span> <span class="nav-text">clickhouse-benchmark</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#clickhouse-mysql"><span class="nav-number">4.3.</span> <span class="nav-text">clickhouse-mysql</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%95%E7%94%A8"><span class="nav-number">5.</span> <span class="nav-text">引用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%AA%E4%BA%BA%E5%A4%87%E6%B3%A8"><span class="nav-number">6.</span> <span class="nav-text">个人备注</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="vgbhfive"
      src="https://i.loli.net/2019/12/10/JF3dKDSkZoPz7h6.jpg">
  <p class="site-author-name" itemprop="name">vgbhfive</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">153</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">51</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/vgbhfive" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;vgbhfive" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:vgbhfive@foxmail.com" title="E-Mail → mailto:vgbhfive@foxmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://vgbhfive.com/" title="vgbhfive → https:&#x2F;&#x2F;vgbhfive.com" rel="noopener" target="_blank"><i class="fab fa-chrome fa-fw"></i>vgbhfive</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.heywhale.com/home/user/profile/65485e27d1e715cc33e7f383" title="Heywhale → https:&#x2F;&#x2F;www.heywhale.com&#x2F;home&#x2F;user&#x2F;profile&#x2F;65485e27d1e715cc33e7f383" rel="noopener" target="_blank"><i class="fab fa-fish fa-fw"></i>Heywhale</a>
      </span>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        
  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">陕ICP备20002937号-1 </a>
  </div>

<div class="copyright">
  
  &copy; 2016 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">vgbhfive</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : '2ff0dea213e4c7c0bbcc',
      clientSecret: '7f3d808240b513b00a1dbf20d725809acc316b67',
      repo        : 'vgbhfive.github.io',
      owner       : 'vgbhfive',
      admin       : ['vgbhfive'],
      id          : '803a08b5dd44e3c2b05e79521f916d80',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>

</body>
</html>
